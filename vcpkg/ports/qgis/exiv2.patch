From 46b886384f67e6905d01c81bb90bd205b10fcc99 Mon Sep 17 00:00:00 2001
From: Denis Rouzaud <denis.rouzaud@gmail.com>
Date: Mon, 20 Oct 2025 06:10:10 +0200
Subject: [PATCH 1/2] [cmake] use exiv2 cmake config

---
 CMakeLists.txt          |  2 +-
 cmake/FindEXIV2.cmake   | 22 ----------------------
 src/core/CMakeLists.txt |  2 +-
 3 files changed, 2 insertions(+), 24 deletions(-)
 delete mode 100644 cmake/FindEXIV2.cmake

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 6281b29545f3..0ec4ac7185a9 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -478,7 +478,7 @@ if(WITH_CORE)
   find_package(ZLIB REQUIRED)       # for decompression of vector tiles in MBTiles file
   message(STATUS "Found zlib: ${ZLIB_LIBRARIES}")
 
-  find_package(EXIV2 REQUIRED)
+  find_package(exiv2 REQUIRED)
 
   # optional
   if (WITH_SFCGAL)
diff --git a/cmake/FindEXIV2.cmake b/cmake/FindEXIV2.cmake
deleted file mode 100644
index 5eb877f036ce..000000000000
--- a/cmake/FindEXIV2.cmake
+++ /dev/null
@@ -1,22 +0,0 @@
-# Find EXIV2
-# ~~~~~~~~~~
-# CMake module to search for EXIV2 library
-#
-# If it's found it sets EXIV2_FOUND to TRUE
-# and following variables are set:
-#    EXIV2_INCLUDE_DIR
-#    EXIV2_LIBRARY
-#
-
-
-FIND_PATH(EXIV2_INCLUDE_DIR exiv2/exiv2.hpp $ENV{LIB_DIR}/include /usr/local/include /usr/include)
-FIND_LIBRARY(EXIV2_LIBRARY NAMES exiv2 PATHS $ENV{LIB_DIR}/lib /usr/local/lib /usr/lib)
-
-IF (EXIV2_INCLUDE_DIR AND EXIV2_LIBRARY)
-    SET(EXIV2_FOUND TRUE)
-    MESSAGE(STATUS "Found exiv2: ${EXIV2_LIBRARY}")
-ELSE (EXIV2_INCLUDE_DIR AND EXIV2_LIBRARY)
-    MESSAGE(EXIV2_INCLUDE_DIR=${EXIV2_INCLUDE_DIR})
-    MESSAGE(EXIV2_LIBRARY=${EXIV2_LIBRARY})
-    MESSAGE(FATAL_ERROR "Could not find exiv2")
-ENDIF (EXIV2_INCLUDE_DIR AND EXIV2_LIBRARY)
diff --git a/src/core/CMakeLists.txt b/src/core/CMakeLists.txt
index 6a9d804e4865..35840a196586 100644
--- a/src/core/CMakeLists.txt
+++ b/src/core/CMakeLists.txt
@@ -2673,7 +2673,7 @@ target_link_libraries(qgis_core
   ${LIBZIP_LIBRARY}
   $<TARGET_NAME_IF_EXISTS:protobuf::libprotobuf-lite>
   ${ZLIB_LIBRARIES}
-  ${EXIV2_LIBRARY}
+  Exiv2::exiv2lib
   PROJ::proj
   nlohmann_json::nlohmann_json
 )

From 88eb5fdcd7afb7bcf97b8c3c2876a8580fe07a0e Mon Sep 17 00:00:00 2001
From: Matthias Kuhn <matthias@opengis.ch>
Date: Mon, 20 Oct 2025 10:13:54 +0200
Subject: [PATCH 2/2] Remove unneeded line

---
 src/core/CMakeLists.txt | 1 -
 1 file changed, 1 deletion(-)

diff --git a/src/core/CMakeLists.txt b/src/core/CMakeLists.txt
index 35840a196586..f67daaeedff9 100644
--- a/src/core/CMakeLists.txt
+++ b/src/core/CMakeLists.txt
@@ -2518,7 +2518,6 @@ target_include_directories(qgis_core SYSTEM PUBLIC
   ${QCA_INCLUDE_DIR}
   ${Protobuf_INCLUDE_DIRS}
   ${ZLIB_INCLUDE_DIRS}
-  ${EXIV2_INCLUDE_DIR}
 )
 
 target_include_directories(qgis_core PUBLIC
